<?xml version="1.0" encoding="UTF-8"?><!--Converted at: Wed May 11 15:49:38 KST 2016-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="KnowledgeDAO">

    <sql id="selectListCondition">
        <where>
	        <if test="searchText != null and searchText != '' and searchType != null">
	            <if test="searchType == 'TITLE' ">
	                AND (TITLE LIKE '%' #{searchText } '%' OR KEYWORD LIKE '%' #{searchText } '%')
	            </if>
	            <if test="searchType == 'REGISTER_ID'">
					AND REGISTER_ID IN (SELECT SID FROM TB_USER WHERE DISPLAY_NAME LIKE '%' #{searchText } '%')
	            </if>
				<if test="searchType == 'OU'">
					AND OU LIKE '%' #{searchText} '%'
				</if>
	        </if>
	        <if test="searchDate != null and searchDate != ''">
	       		<if test="searchDate == 'WEEK'">
	       			AND REGIST_DTM BETWEEN DATE_ADD(SYSDATE(), INTERVAL -1 WEEK) AND SYSDATE()
	       		</if>
	        	<if test="searchDate == 'MONTH'">
	        		AND REGIST_DTM BETWEEN DATE_ADD(SYSDATE(), INTERVAL -1 MONTH) AND SYSDATE()
	        	</if>
	        	<if test="searchDate == 'YEAR'">
	        		AND REGIST_DTM BETWEEN DATE_ADD(SYSDATE(), INTERVAL -1 YEAR) AND SYSDATE()
	        	</if>
	        	<if test="searchDate == 'SELECT'">
	        		AND REGIST_DTM BETWEEN CONVERT(#{startDate},DATETIME) AND CONVERT(#{endDate},DATETIME)
	        	</if>
	        </if>
	        <if test="searchWriter != null and searchWriter != ''">
	       		<if test="searchWriter == 'MINE'">
	       			AND REGISTER_ID = #{sid}
	       		</if>
	        	<if test="searchWriter == 'SELECT'">
	        		<if test="userList != null and !userList.isEmpty()">
	        		AND (
	        			REGISTER_ID IN
	        			<foreach item="user" collection="userList" open="(" separator="," close=")">
        					#{user}
  						</foreach>
  					)
	        		</if>
	        	</if>
	        </if>
        	<if test="knowlgMapType != null and knowlgMapType != ''">
        		AND KNOWLG_MAP_TYPE = #{knowlgMapType}
        	</if>
        	<if test="knowlgMapNo != null and knowlgMapNo != ''">
        		AND KNOWLG_MAP_NO = #{knowlgMapNo}
        	</if>
        	<if test="registerId != null and registerId != ''">
        		AND REGISTER_ID = #{registerId}
        	</if>
        	<if test="approverId != null and approverId != ''">
        		AND APPROVER_ID = #{approverId}
        	</if>
        	<choose>
        		<when test="cmmntyNo != null and cmmntyNo != ''">
				AND CMMNTY_NO = #{cmmntyNo}
        		</when>
        		<otherwise>
        		AND (CMMNTY_NO IS NULL OR CMMNTY_NO = 0)
        		</otherwise>
        	</choose>
        	<if test="isMyList != 'YES'">
        	<choose>
        		<when test="aprvYn != null and aprvYn != ''">
        		AND (APRV_YN = #{aprvYn} AND (APRV_CONT IS NULL OR APRV_CONT = ""))  	
        		</when>
        		<otherwise>
        		AND APRV_YN = 'Y'
        		</otherwise>
        	</choose>
        	</if>
        </where>
    </sql>
    
 	<select id="selectKnowledgeMapList" parameterType="KnowledgeMapVO" resultType="KnowledgeMapVO"> 
 		
			SELECT
				*
			FROM
				TB_KNOWLEDGE_MAP
			<where>
				AND DEL_YN = 'N'
	        	<if test="knowlgMapType != null and knowlgMapType != ''">
	        	AND KNOWLG_MAP_TYPE = #{knowlgMapType}
	        	</if>
				<if test="upNo != null and upNo != '' and upNo != -1">
				AND UP_NO = #{upNo}
				</if>
				<if test="upNo == -1">
				AND (UP_NO IS NULL OR UP_NO = 0)
				</if>
			</where>
			ORDER BY SORT_ORDR
 		
 	</select>
 	
 	<select id="selectKnowledgeMap" parameterType="KnowledgeMapVO" resultType="KnowledgeMapVO"> 

			SELECT
				tkm.*,
				(SELECT KNOWLG_MAP_NM FROM TB_KNOWLEDGE_MAP tkm WHERE tkm.KNOWLG_MAP_NO = (SELECT UP_NO FROM TB_KNOWLEDGE_MAP tkm WHERE tkm.KNOWLG_MAP_NO = #{knowlgMapNo})) AS UP_NM
			FROM
				TB_KNOWLEDGE_MAP tkm
			<where>
				AND DEL_YN = 'N'
				AND KNOWLG_MAP_NO = #{knowlgMapNo}
			</where>
 		
 	</select>
 	
 	<select id="selectKnowledgeList" parameterType="KnowledgeVO" resultType="KnowledgeVO">
		SELECT *
          FROM (SELECT TB_KNOWLEDGE.KNOWLG_NO
		             , TB_KNOWLEDGE.TITLE
		             , TB_KNOWLEDGE.KNOWLG_MAP_NO
		             , TB_KNOWLEDGE.KNOWLG_MAP_TYPE
		             , TB_KNOWLEDGE.SUMMRY
		             , TB_KNOWLEDGE.APRV_YN
		             , TB_KNOWLEDGE.APRV_CONT
		             , TB_KNOWLEDGE.APPROVER_ID
		             , TB_KNOWLEDGE.RLS_YN
		             , TB_KNOWLEDGE.REAL_NM_YN
		             , TB_KNOWLEDGE.COPERTN_WRITNG_YN
		             , TB_KNOWLEDGE.OU_CODE
		             , TB_KNOWLEDGE.CMMNTY_NO
		             , TB_KNOWLEDGE.DOWNLOAD_CNT
		             , TB_KNOWLEDGE.REGISTER_ID
		             , TB_KNOWLEDGE.REGIST_DTM
				     , DATE_FORMAT(TB_KNOWLEDGE.REGIST_DTM, '%Y-%m-%d %T') AS REGIST_DTM_STR
		             , TB_KNOWLEDGE.UPDATER_ID
		             , TB_KNOWLEDGE.UPD_DTM
		             , TB_KNOWLEDGE.DEL_YN
		             , TB_KNOWLEDGE.ATCH_FILE_NO
		             , TB_KNOWLEDGE.RELATE_KNOWLG_NO
		             , TB_KNOWLEDGE.TARGET_NO
		             , TB_KNOWLEDGE.KEYWORD
		             , TB_KNOWLEDGE.OWNER_ID
		             , TB_USER.DISPLAY_NAME
		             , TB_USER.OU
                     , TB_KNOWLEDGE_MAP.PARENT_KNOWLG_MAP_NM
		             , CASE WHEN DATEDIFF(TB_KNOWLEDGE.REGIST_DTM, SYSDATE()) > -4 THEN TRUE ELSE FALSE END AS IS_NEW
		             , ROW_NUMBER() OVER(PARTITION BY TB_KNOWLEDGE.TITLE ORDER BY TB_KNOWLEDGE.KNOWLG_NO DESC) AS ROW_NUM
          			 , (SELECT OU FROM TB_ORG WHERE OU_CODE = TB_KNOWLEDGE.OU_CODE) AS OWNER_OU
          			 , SUM(TB_KNOWLEDGE.INQ_CNT) OVER(PARTITION BY TB_KNOWLEDGE.TITLE) AS INQ_CNT
		          FROM TB_KNOWLEDGE
		          LEFT JOIN TB_USER ON TB_USER.SID = TB_KNOWLEDGE.REGISTER_ID
		          LEFT JOIN (SELECT TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO
		                          , TB_KNOWLEDGE_MAP.KNOWLG_MAP_NM
		                          , TB_KNOWLEDGE_MAP.DEL_YN
		                          , TB_KNOWLEDGE_MAP.SHOW_YN
		                          , PARENT.KNOWLG_MAP_NO AS PARENT_KNOWLG_MAP_NO
		                          , PARENT.KNOWLG_MAP_NM AS PARENT_KNOWLG_MAP_NM
		          			   FROM TB_KNOWLEDGE_MAP LEFT JOIN TB_KNOWLEDGE_MAP AS PARENT ON TB_KNOWLEDGE_MAP.UP_NO = PARENT.KNOWLG_MAP_NO) TB_KNOWLEDGE_MAP
		            ON TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO = TB_KNOWLEDGE.KNOWLG_MAP_NO
                 WHERE TB_KNOWLEDGE.DEL_YN = 'N'
                   AND TB_KNOWLEDGE_MAP.DEL_YN = 'N'
                   AND TB_KNOWLEDGE_MAP.SHOW_YN = 'Y') TB_KNOWLEDGE
		<include refid="selectListCondition" />
		   AND ROW_NUM = 1
		 ORDER BY KNOWLG_NO DESC
		 LIMIT #{itemCountPerPage} OFFSET #{itemOffset}
 	</select>

	<!-- 지식 이력 조회 -->
 	<select id="selectKnowledgeHistoryList" parameterType="KnowledgeVO" resultType="KnowledgeVO">
		/* KnowledgeDAO.selectKnowledgeHistoryList */
		SELECT TB_KNOWLEDGE.KNOWLG_NO
		     , TB_KNOWLEDGE.TITLE
		     , TB_KNOWLEDGE.KNOWLG_MAP_NO
		     , TB_KNOWLEDGE.KNOWLG_MAP_TYPE
		     , TB_KNOWLEDGE.SUMMRY
		     , TB_KNOWLEDGE.APRV_YN
		     , TB_KNOWLEDGE.APRV_CONT
		     , TB_KNOWLEDGE.APPROVER_ID
		     , TB_KNOWLEDGE.RLS_YN
		     , TB_KNOWLEDGE.REAL_NM_YN
		     , TB_KNOWLEDGE.COPERTN_WRITNG_YN
		     , TB_KNOWLEDGE.OU_CODE
		     , TB_KNOWLEDGE.INQ_CNT
		     , TB_KNOWLEDGE.CMMNTY_NO
		     , TB_KNOWLEDGE.DOWNLOAD_CNT
		     , TB_KNOWLEDGE.REGISTER_ID
		     , TB_KNOWLEDGE.REGIST_DTM
			 , DATE_FORMAT(TB_KNOWLEDGE.REGIST_DTM, '%Y-%m-%d %T') AS REGIST_DTM_STR
		     , TB_KNOWLEDGE.UPDATER_ID
		     , TB_KNOWLEDGE.UPD_DTM
		     , TB_KNOWLEDGE.DEL_YN
		     , TB_KNOWLEDGE.ATCH_FILE_NO
		     , TB_KNOWLEDGE.RELATE_KNOWLG_NO
		     , TB_KNOWLEDGE.TARGET_NO
		     , TB_KNOWLEDGE.KEYWORD
		     , TB_KNOWLEDGE.OWNER_ID
		     , TB_USER.DISPLAY_NAME
		     , TB_USER.OU
		  FROM TB_KNOWLEDGE
		  LEFT JOIN TB_USER ON TB_USER.SID = TB_KNOWLEDGE.REGISTER_ID
		 WHERE TB_KNOWLEDGE.TITLE = #{title}
		   AND TB_KNOWLEDGE.KNOWLG_NO != #{knowlgNo}
		   AND TB_KNOWLEDGE.KNOWLG_MAP_TYPE = #{knowlgMapType}
		   AND TB_KNOWLEDGE.KNOWLG_MAP_NO = #{knowlgMapNo}
		   AND TB_KNOWLEDGE.DEL_YN = 'N'
		   AND TB_KNOWLEDGE.APRV_YN = 'Y'
		 ORDER BY KNOWLG_NO DESC
 	</select>
 	
	<select id="selectKnowledgeListCount" parameterType="KnowledgeVO" resultType="int">
		SELECT COUNT(1)
          FROM (SELECT TB_KNOWLEDGE.KNOWLG_NO
		             , TB_KNOWLEDGE.TITLE
		             , TB_KNOWLEDGE.KNOWLG_MAP_NO
		             , TB_KNOWLEDGE.KNOWLG_MAP_TYPE
		             , TB_KNOWLEDGE.SUMMRY
		             , TB_KNOWLEDGE.APRV_YN
		             , TB_KNOWLEDGE.APRV_CONT
		             , TB_KNOWLEDGE.APPROVER_ID
		             , TB_KNOWLEDGE.RLS_YN
		             , TB_KNOWLEDGE.REAL_NM_YN
		             , TB_KNOWLEDGE.COPERTN_WRITNG_YN
		             , TB_KNOWLEDGE.OU_CODE
		             , TB_KNOWLEDGE.CMMNTY_NO
		             , TB_KNOWLEDGE.DOWNLOAD_CNT
		             , TB_KNOWLEDGE.REGISTER_ID
		             , TB_KNOWLEDGE.REGIST_DTM
					 , DATE_FORMAT(TB_KNOWLEDGE.REGIST_DTM, '%Y-%m-%d %T') AS REGIST_DTM_STR
		             , TB_KNOWLEDGE.UPDATER_ID
		             , TB_KNOWLEDGE.UPD_DTM
		             , TB_KNOWLEDGE.DEL_YN
		             , TB_KNOWLEDGE.ATCH_FILE_NO
		             , TB_KNOWLEDGE.RELATE_KNOWLG_NO
		             , TB_KNOWLEDGE.TARGET_NO
		             , TB_KNOWLEDGE.KEYWORD
					 , TB_KNOWLEDGE.OWNER_ID
		             , TB_USER.DISPLAY_NAME
		             , TB_USER.OU
                     , TB_KNOWLEDGE_MAP.PARENT_KNOWLG_MAP_NM
		             , CASE WHEN DATEDIFF(TB_KNOWLEDGE.REGIST_DTM, SYSDATE()) > -4 THEN TRUE ELSE FALSE END AS IS_NEW
		             , ROW_NUMBER() OVER(PARTITION BY TB_KNOWLEDGE.TITLE ORDER BY TB_KNOWLEDGE.KNOWLG_NO DESC) AS ROW_NUM
					 , (SELECT OU FROM TB_ORG WHERE OU_CODE = TB_KNOWLEDGE.OU_CODE) AS OWNER_OU
				 	 , SUM(TB_KNOWLEDGE.INQ_CNT) OVER(PARTITION BY TB_KNOWLEDGE.TITLE) AS INQ_CNT
		          FROM TB_KNOWLEDGE
		          LEFT JOIN TB_USER ON TB_USER.SID = TB_KNOWLEDGE.REGISTER_ID
		          LEFT JOIN (SELECT TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO
		                          , TB_KNOWLEDGE_MAP.KNOWLG_MAP_NM
		                          , TB_KNOWLEDGE_MAP.DEL_YN
		                          , TB_KNOWLEDGE_MAP.SHOW_YN
		                          , PARENT.KNOWLG_MAP_NO AS PARENT_KNOWLG_MAP_NO
		                          , PARENT.KNOWLG_MAP_NM AS PARENT_KNOWLG_MAP_NM
		          			   FROM TB_KNOWLEDGE_MAP LEFT JOIN TB_KNOWLEDGE_MAP AS PARENT ON TB_KNOWLEDGE_MAP.UP_NO = PARENT.KNOWLG_MAP_NO) TB_KNOWLEDGE_MAP
		            ON TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO = TB_KNOWLEDGE.KNOWLG_MAP_NO
                 WHERE TB_KNOWLEDGE.DEL_YN = 'N'
                   AND TB_KNOWLEDGE_MAP.DEL_YN = 'N'
                   AND TB_KNOWLEDGE_MAP.SHOW_YN = 'Y') TB_KNOWLEDGE
		<include refid="selectListCondition" />
		   AND ROW_NUM = 1
    </select>
    
    <select id="selectKnowledgeLastUpdated" parameterType="KnowledgeVO" resultType="java.sql.Date"> 
 		
			SELECT
				REGIST_DTM	
			FROM
				TB_KNOWLEDGE tk
	        <where>
				AND TITLE = #{title}
				AND KNOWLG_MAP_TYPE = #{knowlgMapType}
				AND KNOWLG_MAP_NO = #{knowlgMapNo}
				AND DEL_YN = 'N'
				AND APRV_YN = 'Y'
	        </where>
			ORDER BY KNOWLG_NO DESC
			LIMIT 1
			  	 		
 	</select>

	<!-- 지식 상세 -->
    <select id="selectKnowledgeDetail" parameterType="KnowledgeVO" resultType="KnowledgeVO">
		/* KnowledgeDAO.selectKnowledgeDetail */
		SELECT TB_KNOWLEDGE.KNOWLG_NO
		     , TB_KNOWLEDGE.TITLE
		     , TB_KNOWLEDGE.KNOWLG_MAP_NO
		     , TB_KNOWLEDGE.KNOWLG_MAP_TYPE
		     , TB_KNOWLEDGE.SUMMRY
		     , TB_KNOWLEDGE.APRV_YN
		     , TB_KNOWLEDGE.APRV_CONT
		     , TB_KNOWLEDGE.APPROVER_ID
		     , TB_KNOWLEDGE.RLS_YN
		     , TB_KNOWLEDGE.REAL_NM_YN
		     , TB_KNOWLEDGE.COPERTN_WRITNG_YN
		     , TB_KNOWLEDGE.OU_CODE
		     , TB_KNOWLEDGE.INQ_CNT
		     , TB_KNOWLEDGE.CMMNTY_NO
		     , TB_KNOWLEDGE.DOWNLOAD_CNT
		     , TB_KNOWLEDGE.REGISTER_ID
		     , TB_KNOWLEDGE.REGIST_DTM
		     , DATE_FORMAT(TB_KNOWLEDGE.REGIST_DTM, '%Y-%m-%d %T') AS REGIST_DTM_STR
		     , TB_KNOWLEDGE.UPDATER_ID
		     , TB_KNOWLEDGE.UPD_DTM
		     , TB_KNOWLEDGE.DEL_YN
		     , TB_KNOWLEDGE.ATCH_FILE_NO
		     , TB_KNOWLEDGE.RELATE_KNOWLG_NO
		     , TB_KNOWLEDGE.TARGET_NO
		     , TB_KNOWLEDGE.KEYWORD
		     , TB_KNOWLEDGE.OWNER_ID
			 , TB_USER.DISPLAY_NAME
			 , TB_USER.OU
		     , TB_KNOWLEDGE_MAP.KNOWLG_MAP_NM
		     , TB_KNOWLEDGE_MAP.PARENT_KNOWLG_MAP_NO AS UP_NO
		     , TB_KNOWLEDGE_MAP.PARENT_KNOWLG_MAP_NM AS UP_NM
			 , (SELECT OU FROM TB_ORG WHERE OU_CODE = TB_KNOWLEDGE.OU_CODE) AS OWNER_OU
		  FROM TB_KNOWLEDGE
		  LEFT JOIN TB_USER ON TB_USER.SID = TB_KNOWLEDGE.REGISTER_ID
		  LEFT JOIN (SELECT TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO
		                  , TB_KNOWLEDGE_MAP.KNOWLG_MAP_NM
		                  , TB_KNOWLEDGE_MAP.DEL_YN
		                  , TB_KNOWLEDGE_MAP.SHOW_YN
		                  , PARENT.KNOWLG_MAP_NO AS PARENT_KNOWLG_MAP_NO
		                  , PARENT.KNOWLG_MAP_NM AS PARENT_KNOWLG_MAP_NM
		               FROM TB_KNOWLEDGE_MAP LEFT JOIN TB_KNOWLEDGE_MAP AS PARENT ON TB_KNOWLEDGE_MAP.UP_NO = PARENT.KNOWLG_MAP_NO) TB_KNOWLEDGE_MAP
		    ON TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO = TB_KNOWLEDGE.KNOWLG_MAP_NO
	     WHERE TB_KNOWLEDGE.DEL_YN = 'N'
           AND TB_KNOWLEDGE_MAP.DEL_YN = 'N'
           AND TB_KNOWLEDGE_MAP.SHOW_YN = 'Y'
		<if test="title != null and title != ''">
		   AND TB_KNOWLEDGE.TITLE = #{title}
		</if>
		<if test="knowlgNo != null and knowlgNo != ''">
		   AND TB_KNOWLEDGE.KNOWLG_NO = #{knowlgNo}
		</if>
		 ORDER BY TB_KNOWLEDGE.KNOWLG_NO DESC
		 LIMIT 1
 	</select>
 	
 	<select id="selectKnowledgeContentsList" parameterType="KnowledgeVO" resultType="KnowledgeContentsVO"> 
 		
			SELECT
				*	
			FROM
				TB_KNOWLEDGE_CONTENTS
			WHERE 
				KNOWLG_NO = #{knowlgNo}
				AND TITLE = #{title}
			  	 		
 	</select>
 	
 	<select id="selectKnowledgeContentsDetail" parameterType="KnowledgeContentsVO" resultType="KnowledgeContentsVO"> 
 		
			SELECT
				*	
			FROM
				TB_KNOWLEDGE_CONTENTS
			<where>
				AND KNOWLG_NO = #{knowlgNo}
				AND TITLE = #{title}
				AND SORT_ORDR = #{sortOrdr}
			</where>
			
 	</select>
 	
	<insert id="insertKnowledge" parameterType="KnowledgeVO" useGeneratedKeys="true" keyProperty="knowlgNo">
		/* KnowledgeDAO.insertKnowledge */
		INSERT INTO TB_KNOWLEDGE
		     ( TITLE
		     , KNOWLG_MAP_NO
		     , KNOWLG_MAP_TYPE
		     , SUMMRY
		     , APRV_YN
		     , APPROVER_ID
		     , RLS_YN
		     , REAL_NM_YN
		     , COPERTN_WRITNG_YN
		     , OU_CODE
		     , INQ_CNT
		     , CMMNTY_NO
		     , DOWNLOAD_CNT
		     , ATCH_FILE_NO
		     , RELATE_KNOWLG_NO
		     , TARGET_NO
		     , KEYWORD
		     , REGISTER_ID
		     , REGIST_DTM
		     , UPDATER_ID
		     , UPD_DTM
		     , DEL_YN
		     , OWNER_ID
		     )
		VALUES
		     ( #{title}
		     , #{knowlgMapNo}
		     , #{knowlgMapType}
		     , #{summry}
		     , #{aprvYn}
		     , #{approverId}
		     , #{rlsYn}
		     , #{realNmYn}
		     , #{copertnWritngYn}
		     , #{ouCode}
		     , 0
		     , #{cmmntyNo}
		     , 0
		     , #{atchFileNo}
		     , #{relateKnowlgNo}
		     , #{targetNo}
		     , #{keyword}
		     , #{registerId}
		     , SYSDATE()
		     , #{registerId}
		     , SYSDATE()
		     , 'N'
		     , #{ownerId}
		     )
 	</insert>

	<insert id="insertKnowledgeModificationRequest" parameterType="KnowledgeVO" useGeneratedKeys="true" keyProperty="requestNo">
		/* KnowledgeDAO.insertKnowledgeModificationRequest */
		INSERT INTO TB_KNOWLEDGE_MODIFICATION_REQUEST
		     ( KNOWLG_NO
		     , REQUEST_CONTENT
		     , ATCH_FILE_NO
		     , REGISTER_ID
		     , REGIST_DTM
		     )
		VALUES
		     ( #{knowlgNo}
		     , #{requestContent}
		     , #{atchFileNo}
		     , #{registerId}
		     , SYSDATE()
		     )
	</insert>

 	<insert id="insertKnowledgeContents" parameterType="KnowledgeVO">
 		
			INSERT INTO TB_KNOWLEDGE_CONTENTS
			(KNOWLG_NO, TITLE, SORT_ORDR, SUBTITLE, CONT)
			VALUES
			(#{knowlgNo}, #{title}, #{sortOrdr}, #{subtitle}, #{cont})
			ON DUPLICATE KEY
			UPDATE
				SUBTITLE = #{subtitle},
				CONT = #{cont}				
 			
 	</insert>

	<insert id="insertKnowledgeModificationRequestContent" parameterType="KnowledgeVO">
		/* KnowledgeDAO.insertKnowledgeModificationRequestContent */
		INSERT INTO TB_KNOWLEDGE_MODIFICATION_REQUEST_CONTENT
		     ( REQUEST_NO
		     , SORT_ORDR
		     , SUBTITLE
		     , CONT
		     )
		VALUES
		     ( #{requestNo}
		     , #{sortOrdr}
		     , #{subtitle}
		     , #{cont}
		     )
	</insert>

 	<update id="updateKnowledgeContents" parameterType="KnowledgeVO">
 	
 			UPDATE
 				TB_KNOWLEDGE_CONTENTS
 			SET
 				CONT = #{cont}
 			<where>
 				AND KNOWLG_NO = #{knowlgNo}
 				AND SORT_ORDR = #{sortOrdr}
 			</where>
 	</update>

	<update id="updateKnowledgeModificationRequestContent" parameterType="KnowledgeVO">
		/* KnowledgeDAO.updateKnowledgeModificationRequestContent */
		UPDATE TB_KNOWLEDGE_MODIFICATION_REQUEST_CONTENT
		   SET CONT = #{cont}
		 WHERE REQUEST_NO = #{requestNo}
		   AND SORT_ORDR = #{sortOrdr}
	</update>

 	<insert id="insertRelateKnowledge" useGeneratedKeys="true" keyProperty="relateKnowlgNo" parameterType="KnowledgeVO">
		
			INSERT INTO TB_RELATE_KNOWLEDGE
			(REGIST_DTM, DEL_YN)
			VALUES
			(SYSDATE(), 'N')
		
	</insert>
	
	<insert id="insertRelateKnowledgeDetail" parameterType="KnowledgeVO">
		
			INSERT INTO TB_RELATE_KNOWLEDGE_DETAIL
			(RELATE_KNOWLG_NO, SORT_ORDR, TITLE)
			VALUES
			( #{relateKnowlgNo}, #{sortOrdr}, #{relateKnowlgTitle} )			
		
	</insert>
	
	<select id="selectRelateKnowledgeList" parameterType="long" resultType="String">
			SELECT
				TITLE
			FROM
				TB_RELATE_KNOWLEDGE_DETAIL
			WHERE
				RELATE_KNOWLG_NO = #{relateKnowlgNo}
			ORDER BY SORT_ORDR
	</select>
	
	<select id="selectRelateKnowledgeListDelChk" parameterType="long" resultType="KnowledgeVO">
			SELECT
				RELATE_KNOWLG_NO,
				SORT_ORDR,
				TITLE
			FROM
				TB_RELATE_KNOWLEDGE_DETAIL
			WHERE
				RELATE_KNOWLG_NO = #{relateKnowlgNo}
			ORDER BY SORT_ORDR
	</select>
	
	<delete id="deleteRelateKnowlg" parameterType="RelateKnowlgVO">
	
			DELETE
			FROM
				TB_RELATE_KNOWLEDGE_DETAIL
			<where>
				AND RELATE_KNOWLG_NO = #{relateKnowlgNo}
				AND SORT_ORDR = #{sortOrdr}
			</where>
	
	</delete>
	
	<update id="updateKnowlg" parameterType="KnowledgeVO">
	
			UPDATE
				TB_KNOWLEDGE
			SET
				DEL_YN = 'Y'
			<where>
				AND KNOWLG_NO = #{knowlgNo}
				AND TITLE = #{title}
			</where>
	
	</update>
	
	<update id="updateApproval" parameterType="KnowledgeVO">
	
			UPDATE
				TB_KNOWLEDGE
			SET
				APRV_YN = #{aprvYn},
				APRV_CONT = #{aprvCont},
				APPROVER_ID = #{approverId}
			<where>
				AND KNOWLG_NO = #{knowlgNo}
				AND TITLE = #{title}
			</where>
	
	</update>
	
	<insert id="insertUserMileage" parameterType="KnowledgeVO">
		
			INSERT INTO TB_USER_MILEAGE
			(MILEAGE_TYPE, KNOWLG_NO, MILEAGE_SCORE, SID, REGIST_DTM)
			VALUES
			(#{mileageType}, #{knowlgNo}, #{mileageScore}, #{registerId}, SYSDATE())			
		
	</insert>
	
	<insert id="insertOrgMileage" parameterType="KnowledgeVO">
		
			INSERT INTO TB_ORG_MILEAGE
			(MILEAGE_TYPE, KNOWLG_NO, MILEAGE_SCORE, OU_CODE, REGIST_DTM)
			VALUES
			(#{mileageType}, #{knowlgNo}, #{mileageScore}, #{ouCode}, SYSDATE())
		
	</insert>
	
	<delete id="deleteUserMileage" parameterType="KnowledgeVO">

			DELETE
			FROM
				TB_USER_MILEAGE
			<where>
				AND KNOWLG_NO = #{knowlgNo}
				<if test="mileageType != null and  mileageType !=''">
				AND MILEAGE_TYPE = #{mileageType}
				</if>
			</where>
	
	</delete>
	
	<delete id="deleteOrgMileage" parameterType="KnowledgeVO">
		
			DELETE
			FROM
				TB_ORG_MILEAGE
			<where>
				AND KNOWLG_NO = #{knowlgNo}
			</where>
	
	</delete>

	<delete id="deleteUserMileageByTitle" parameterType="KnowledgeVO">
		DELETE FROM TB_USER_MILEAGE
		 WHERE KNOWLG_NO IN (SELECT KNOWLG_NO FROM TB_KNOWLEDGE WHERE DEL_YN = 'N' AND TITLE = #{title})
	</delete>

	<delete id="deleteOrgMileageByTitle" parameterType="KnowledgeVO">
		DELETE FROM TB_ORG_MILEAGE
		 WHERE KNOWLG_NO IN (SELECT KNOWLG_NO FROM TB_KNOWLEDGE WHERE DEL_YN = 'N' AND TITLE = #{title})
	</delete>
	
	<select id="selectUserMileageList" parameterType="UserMileageVO" resultType="UserMileageVO">
	
			SELECT
				tum.*,
				tu.DISPLAY_NAME,
				(SELECT OU FROM TB_ORG tr WHERE tr.OU_CODE = tu.OU_CODE) AS OU,
				SUM(MILEAGE_SCORE) AS TOTAL_SCORE
			FROM
				TB_USER_MILEAGE tum
			LEFT JOIN TB_USER tu ON tu.SID = tum.SID
			<where>
	        	<if test="searchText != null and searchText != ''">
	        	AND tu.DISPLAY_NAME LIKE '%' #{searchText} '%'
	        	</if>	        
	        </where>
			GROUP BY tum.SID
			ORDER BY tum.REGIST_DTM DESC
			LIMIT #{itemCountPerPage} OFFSET #{itemOffset}
			
	</select>
	
	<select id="selectUserMileageListCount" parameterType="KnowledgeVO" resultType="int">
	
			SELECT
				COUNT(*)
			FROM(
				SELECT
					tum.*,
					tu.DISPLAY_NAME,
					(SELECT OU FROM TB_ORG tr WHERE tr.OU_CODE = tu.OU_CODE) AS OU,
					SUM(MILEAGE_SCORE) AS TOTAL_SCORE
				FROM
					TB_USER_MILEAGE tum
				LEFT JOIN TB_USER tu ON tu.SID = tum.SID
				<where>
		        	<if test="searchText != null and searchText != ''">
		        	AND tu.DISPLAY_NAME LIKE '%' #{searchText} '%'
		        	</if>	        
		        </where>
				GROUP BY tum.SID
			) T
	        
    </select>
	
	<select id="selectUserMileageDetail" parameterType="UserMileageVO" resultType="UserMileageVO">
	
			SELECT
				tum.*,
				tu.DISPLAY_NAME,
				(SELECT OU FROM TB_ORG tr WHERE tr.OU_CODE = tu.OU_CODE) AS OU,
				(SELECT TITLE FROM TB_KNOWLEDGE tk WHERE tk.KNOWLG_NO = tum.KNOWLG_NO) AS TITLE
			FROM
				TB_USER_MILEAGE tum
			LEFT JOIN TB_USER tu ON tu.SID = tum.SID
	        <where>
	        	AND tum.SID = #{sid}
	        	<if test="searchText != null and searchText != ''">
	        	AND tu.DISPLAY_NAME LIKE '%' #{searchText} '%'
	        	</if>
	        </where>
			ORDER BY tum.REGIST_DTM DESC
	        LIMIT #{itemCountPerPage} OFFSET #{itemOffset}
			
	</select>
	
	<select id="selectUserMileageDetailCount" parameterType="UserMileageVO" resultType="int">
	
			SELECT
				COUNT(*)
			FROM(
				SELECT
					tum.*,
					tu.DISPLAY_NAME,
					(SELECT OU FROM TB_ORG tr WHERE tr.OU_CODE = tu.OU_CODE) AS OU,
					(SELECT TITLE FROM TB_KNOWLEDGE tk WHERE tk.KNOWLG_NO = tum.KNOWLG_NO) AS TITLE
				FROM
					TB_USER_MILEAGE tum
				LEFT JOIN TB_USER tu ON tu.SID = tum.SID
		        <where>
		        	AND tum.SID = #{sid}
		        	<if test="searchText != null and searchText != ''">
		        	AND tu.DISPLAY_NAME LIKE '%' #{searchText} '%'
		        	</if>
		        </where>
			) T
			
	</select>
	
	<select id="selectOrgMileageList" parameterType="OrgMileageVO" resultType="OrgMileageVO">
	
			SELECT
				tom.*,
				tr.OU,
				SUM(tom.MILEAGE_SCORE) AS TOTAL_SCORE
			FROM
				TB_ORG_MILEAGE tom
			LEFT JOIN TB_ORG tr ON tr.OU_CODE = tom.OU_CODE
	        <where>
	        	<if test="searchText != null and searchText != ''">
	        	AND tr.OU LIKE '%' #{searchText} '%'
	        	</if>
	        </where>
			GROUP BY tom.OU_CODE
			ORDER BY tom.REGIST_DTM DESC
			LIMIT #{itemCountPerPage} OFFSET #{itemOffset}
			
	</select>
	
	<select id="selectOrgMileageListCount" parameterType="OrgMileageVO" resultType="int">
	
			SELECT
				COUNT(*)
			FROM(
				SELECT
					tom.*,
					tr.OU,
					SUM(tom.MILEAGE_SCORE) AS TOTAL_SCORE
				FROM
					TB_ORG_MILEAGE tom
				LEFT JOIN TB_ORG tr ON tr.OU_CODE = tom.OU_CODE
		        <where>
		        	<if test="searchText != null and searchText != ''">
		        	AND tr.OU LIKE '%' #{searchText} '%'
		        	</if>
		        </where>
				GROUP BY tom.OU_CODE
			) T
			
	</select>
	
	<select id="selectOrgMileageDetail" parameterType="OrgMileageVO" resultType="OrgMileageVO">
	
			SELECT
				tom.*,
				tr.OU,
				(SELECT TITLE FROM TB_KNOWLEDGE tk WHERE tk.KNOWLG_NO = tom.KNOWLG_NO) AS TITLE
			FROM
				TB_ORG_MILEAGE tom
			LEFT JOIN TB_ORG tr ON tr.OU_CODE = tom.OU_CODE
	        <where>
				AND tom.OU_CODE = #{ouCode}
	        	<if test="searchText != null and searchText != ''">
	        	AND tr.OU LIKE '%' #{searchText} '%'
	        	</if>
	        </where>
			ORDER BY tom.REGIST_DTM
	        LIMIT #{itemCountPerPage} OFFSET #{itemOffset}
			
	</select>
	
	<select id="selectOrgMileageDetailCount" parameterType="OrgMileageVO" resultType="int">
	
			SELECT
				COUNT(*)
			FROM(
				SELECT
					tom.*,
					tr.OU,
					(SELECT TITLE FROM TB_KNOWLEDGE tk WHERE tk.KNOWLG_NO = tom.KNOWLG_NO) AS TITLE
				FROM
					TB_ORG_MILEAGE tom
				LEFT JOIN TB_ORG tr ON tr.OU_CODE = tom.OU_CODE
		        <where>
					AND tom.OU_CODE = #{ouCode}
		        	<if test="searchText != null and searchText != ''">
		        	AND tr.OU LIKE '%' #{searchText} '%'
		        	</if>
		        </where>
			) T
			
	</select>
	
	<select id="selectErrorStatementList" parameterType="ErrorStatementVO" resultType="ErrorStatementVO">
			
			SELECT
				*
				, CASE WHEN DATEDIFF(REGIST_DTM, SYSDATE()) > -4 THEN TRUE ELSE FALSE END AS IS_NEW
			FROM
				TB_ERROR_KNOWLEDGE_STATEMENT
			<where>
				AND DEL_YN = 'N'
				<if test="registerId != null and registerId != ''">
				AND REGISTER_ID = #{registerId}
				</if>
				<if test="searchText != null and searchText != ''">
        		AND STATMNT_TITLE LIKE '%' #{searchText} '%'
        		</if>
        		<if test="answerYn != null and answerYn != ''">
        		AND ANSWER_YN = #{answerYn}
        		</if>		
			</where>
			ORDER BY REGIST_DTM DESC
			
	</select>
	
	<select id="selectErrorStatementListCount" parameterType="ErrorStatementVO" resultType="int">
	
			SELECT
				COUNT(*)
			FROM
				TB_ERROR_KNOWLEDGE_STATEMENT
			<where>
				AND DEL_YN = 'N'
				<if test="registerId != null and registerId != ''">
				AND REGISTER_ID = #{registerId}
				</if>
				<if test="searchText != null and searchText != ''">
        		AND STATMNT_TITLE LIKE '%' #{searchText} '%'
        		</if>
        		<if test="answerYn != null and answerYn != ''">
        		AND ANSWER_YN = #{answerYn}
        		</if>		
			</where>
				
	</select>
	
    <select id="selectErrorStatementPre" parameterType="ErrorStatementVO" resultType="ErrorStatementVO">

        SELECT 
        	*
        FROM 
        	TB_ERROR_KNOWLEDGE_STATEMENT
        WHERE 
        	STATMNT_NO IN (
            	SELECT * FROM (
                	(
                		SELECT STATMNT_NO FROM TB_ERROR_KNOWLEDGE_STATEMENT
						<where>
							AND DEL_YN = 'N'
							AND STATMNT_NO <![CDATA[>]]> #{statmntNo}
							<if test="registerId != null and registerId != ''">
							AND REGISTER_ID = #{registerId}
							</if>
							<if test="searchText != null and searchText != ''">
			        		AND STATMNT_TITLE LIKE '%' #{searchText} '%'
			        		</if>
			        		<if test="answerYn != null and answerYn != ''">
			        		AND ANSWER_YN = #{answerYn}
			        		</if>
						</where>
						ORDER BY STATMNT_NO LIMIT 1
                	) as STATMNT_NO
            	)
        	)

    </select>

    <select id="selectErrorStatementNext" parameterType="ErrorStatementVO" resultType="ErrorStatementVO">
        
        SELECT 
        	*
        FROM 
        	TB_ERROR_KNOWLEDGE_STATEMENT
        WHERE 
        	STATMNT_NO IN (
            	SELECT * FROM (
                	(
                    	SELECT STATMNT_NO FROM TB_ERROR_KNOWLEDGE_STATEMENT
						<where>
							AND DEL_YN = 'N'
                    		AND STATMNT_NO <![CDATA[<]]> #{statmntNo}
							<if test="registerId != null and registerId != ''">
							AND REGISTER_ID = #{registerId}
							</if>
							<if test="searchText != null and searchText != ''">
			        		AND STATMNT_TITLE LIKE '%' #{searchText} '%'
			        		</if>
			        		<if test="answerYn != null and answerYn != ''">
			        		AND ANSWER_YN = #{answerYn}
			        		</if>
						</where>
						 ORDER BY STATMNT_NO DESC LIMIT 1
                	) as STATMNT_NO
            	)
        	)
        	
    </select>
	
	<select id="selectErrorStatementDetail" parameterType="ErrorStatementVO" resultType="ErrorStatementVO">
			
			SELECT
				teks.*,
				(SELECT DISPLAY_NAME FROM TB_USER tu WHERE tu.SID = teks.REGISTER_ID) AS DISPLAY_NAME,
				(SELECT OU FROM TB_ORG tg WHERE tg.OU_CODE = (SELECT OU_CODE FROM TB_USER tu WHERE tu.SID = teks.REGISTER_ID)) AS OU,
				(SELECT DISPLAY_NAME FROM TB_USER tu WHERE tu.SID = teks.ANSWER_ID) AS ANSWER_DISPLAY_NAME,
				(SELECT OU FROM TB_ORG tg WHERE tg.OU_CODE = (SELECT OU_CODE FROM TB_USER tu WHERE tu.SID = teks.ANSWER_ID)) AS ANSWER_OU
			FROM
				TB_ERROR_KNOWLEDGE_STATEMENT teks
			<where>
				AND STATMNT_NO = #{statmntNo}
			</where>
	
	</select>
	
	<insert id="insertErrorStatement" parameterType="ErrorStatementVO">
	
			INSERT INTO TB_ERROR_KNOWLEDGE_STATEMENT
			(TITLE, STATMNT_TITLE, CONT, ANSWER_YN, REGISTER_ID, REGIST_DTM, UPDATER_ID, UPD_DTM, DEL_YN)
			VALUES
			(#{title}, #{statmntTitle}, #{cont}, 'N', #{registerId}, SYSDATE(), #{registerId}, SYSDATE(), 'N')	
	
	</insert>
	
	<update id="updateErrorStatement" parameterType="ErrorStatementVO">
	
			UPDATE
				TB_ERROR_KNOWLEDGE_STATEMENT
			SET
				TITLE = #{title},
				STATMNT_TITLE = #{statmntTitle},
				CONT = #{cont},
				UPDATER_ID = #{registerId},
				UPD_DTM = SYSDATE()
			<where>
				AND STATMNT_NO = #{statmntNo}
			</where>	
	
	</update>
	
	<update id="updateErrorStatementAnswer" parameterType="ErrorStatementVO">
	
			UPDATE
				TB_ERROR_KNOWLEDGE_STATEMENT
			SET
				ANSWER_ID = #{answerId},
				ANSWER_CONT = #{answerCont},
				ANSWER_YN = 'Y',
				ANSWER_DTM = SYSDATE()
			<where>
				AND STATMNT_NO = #{statmntNo}
			</where>
	
	</update>
	
	<select id="selectBookmarkList" parameterType="KnowledgeVO" resultType="KnowledgeVO">
		SELECT TITLE
		     , REGISTER_ID
		     , REGIST_DTM
		  FROM TB_BOOKMARK_KNOWLEDGE
		 WHERE REGISTER_ID = #{registerId}
		 ORDER BY REGIST_DTM DESC
	</select>
	
	<insert id="insertBookmark" parameterType="KnowledgeVO">
	
			INSERT INTO TB_BOOKMARK_KNOWLEDGE
			(TITLE, REGISTER_ID, REGIST_DTM)
			VALUES
			(#{title}, #{registerId}, SYSDATE())	
	
	</insert>
	
	<delete id="deleteBookmark" parameterType="KnowledgeVO">
		DELETE FROM TB_BOOKMARK_KNOWLEDGE
		 WHERE TITLE = #{title}
		   AND REGISTER_ID = #{registerId}
	</delete>

	<!-- 지식 삭제 -->
	<delete id="deleteKnowledge" parameterType="KnowledgeVO">
		/* KnowledgeDAO.deleteKnowledge */
		UPDATE TB_KNOWLEDGE
   		   SET DEL_YN = 'Y'
 		 WHERE KNOWLG_NO IN (SELECT KNOWLG_NO FROM TB_KNOWLEDGE WHERE DEL_YN = 'N' AND TITLE = #{title})
	</delete>
	
	<update id="updateInqCnt" parameterType="KnowledgeVO"> 
		
			UPDATE
				TB_KNOWLEDGE
			SET
				INQ_CNT = INQ_CNT + 1
			<where>
				AND KNOWLG_NO = #{knowlgNo}
			</where>				
	
	</update>
	
	<insert id="insertRecommend" parameterType="KnowledgeVO">
	
			INSERT INTO TB_KNOWLEDGE_RECOMMEND
			(KNOWLG_NO, REGISTER_ID, REGIST_DTM)
			VALUES
			(#{knowlgNo}, #{registerId}, SYSDATE())
	
	</insert>
	
	<delete id="deleteRecommend" parameterType="KnowledgeVO">
	
			DELETE
			FROM
				TB_KNOWLEDGE_RECOMMEND
			<where>
				AND KNOWLG_NO = #{knowlgNo}
				AND REGISTER_ID = #{registerId}
			</where>
	
	</delete>
		
	<select id="selectRecommendCount" parameterType="KnowledgeVO" resultType="int">
    
        	SELECT
        		COUNT(*)
        	FROM
        		TB_KNOWLEDGE_RECOMMEND
        	<where>
        		AND KNOWLG_NO = #{knowlgNo}
        	</where>
        	
    </select>
    
	<select id="selectRecommend" parameterType="KnowledgeVO" resultType="KnowledgeVO">
    
        	SELECT
        		*
        	FROM
        		TB_KNOWLEDGE_RECOMMEND
        	<where>
        		AND KNOWLG_NO = #{knowlgNo}
        		AND REGISTER_ID = #{registerId}
        	</where>
        	
    </select>
    
	<insert id="insertInterests" parameterType="KnowledgeVO">
	
			INSERT INTO TB_INTERESTS
			(KNOWLG_MAP_NO, REGISTER_ID, REGIST_DTM)
			VALUES
			(#{knowlgMapNo}, #{registerId}, SYSDATE())
	
	</insert>
	
	<delete id="deleteInterests" parameterType="KnowledgeVO">
	
			DELETE
			FROM
				TB_INTERESTS
			<where>
				AND KNOWLG_MAP_NO = #{knowlgMapNo}
				AND REGISTER_ID = #{registerId}
			</where>
	
	</delete>
	
	<select id="selectInterests" parameterType="KnowledgeVO" resultType="KnowledgeVO">
    
        	SELECT
        		*
        	FROM
        		TB_INTERESTS
        	<where>
        		AND KNOWLG_MAP_NO = #{knowlgMapNo}
        		AND REGISTER_ID = #{registerId}
        	</where>
        	
    </select>
    
	<select id="selectInterestsList" parameterType="KnowledgeVO" resultType="KnowledgeVO">
    
        	SELECT
        		ti.*,
        		(SELECT KNOWLG_MAP_TYPE FROM TB_KNOWLEDGE_MAP tkm WHERE tkm.KNOWLG_MAP_NO = ti.KNOWLG_MAP_NO) AS KNOWLG_MAP_TYPE,
				(SELECT KNOWLG_MAP_NM FROM TB_KNOWLEDGE_MAP tkm WHERE tkm.KNOWLG_MAP_NO = ti.KNOWLG_MAP_NO) AS KNOWLG_MAP_NM,
				(SELECT UP_NO FROM TB_KNOWLEDGE_MAP tkm WHERE tkm.KNOWLG_MAP_NO = ti.KNOWLG_MAP_NO) AS UP_NO,
				(SELECT KNOWLG_MAP_NM FROM TB_KNOWLEDGE_MAP tkm WHERE tkm.KNOWLG_MAP_NO = (SELECT UP_NO FROM TB_KNOWLEDGE_MAP tkm WHERE tkm.KNOWLG_MAP_NO = ti.KNOWLG_MAP_NO)) AS UP_NM
        	FROM
        		TB_INTERESTS ti
        	<where>
        		AND REGISTER_ID = #{registerId}
        	</where>
        	ORDER BY KNOWLG_MAP_TYPE, KNOWLG_MAP_NM
        	
    </select>
    
    <insert id="insertKnowledgeMap" parameterType="KnowledgeMapVO" useGeneratedKeys="true" keyProperty="knowlgMapNo">
		
			INSERT INTO TB_KNOWLEDGE_MAP
			(KNOWLG_MAP_TYPE, KNOWLG_MAP_NM, UP_NO, SORT_ORDR, REGISTER_ID, REGIST_DTM, UPDATER_ID, UPD_DTM, DEL_YN)
			VALUES
			(#{knowlgMapType}, #{knowlgMapNm}, #{upNo}, #{sortOrdr}, #{registerId}, SYSDATE(), #{registerId}, SYSDATE(), 'N')		
		
	</insert>
			
	<delete id="updateKnowledgeMap" parameterType="KnowledgeMapVO">
		
			UPDATE TB_KNOWLEDGE_MAP
			SET
				KNOWLG_MAP_TYPE = #{knowlgMapType},
				KNOWLG_MAP_NM = #{knowlgMapNm},
				UP_NO = #{upNo},
				SORT_ORDR = #{sortOrdr},
				UPDATER_ID = #{registerId},
				UPD_DTM = SYSDATE()
			WHERE
				KNOWLG_MAP_NO = #{knowlgMapNo}
			
	</delete>

	<!-- 지식맵 삭제 -->
	<update id="deleteKnowledgeMap" parameterType="KnowledgeMapVO">
		/* KnowledgeDAO.deleteKnowledgeMap */
		UPDATE TB_KNOWLEDGE_MAP
		   SET DEL_YN = 'Y'
		     , UPDATER_ID = #{registerId}
		     , UPD_DTM = SYSDATE()
		 WHERE KNOWLG_MAP_NO = #{knowlgMapNo} OR UP_NO = #{knowlgMapNo}
	</update>
	
	<select id="selectKnowledgeTitle" resultType="String">
			
			SELECT
				DISTINCT(TITLE) AS TITLE
			FROM
				TB_KNOWLEDGE
			
	</select>
	
	<update id="updateKnowledgeLink" parameterType="KnowledgeVO">
			
			<![CDATA[
			UPDATE TB_KNOWLEDGE_CONTENTS
			SET
				CONT = REPLACE(CONT, #{title}, '<a href=\"/kno/knowledgeDetail.do?title=${title}\">${title}</a>')
			]]>
			
	</update>
	
	<select id="selectKnowledgeMapLogList" resultType="LogVO">
		
		SELECT
			a.*
			, e.DISPLAY_NAME as REGISTER_NAME
			, e.ou
			, e.USER_FULL_NAME as registerFullName
		FROM
			TB_USER_LOG a
			LEFT OUTER JOIN TB_USER e ON a.REGISTER_ID = e.SID
		<where>
			AND a.DEL_YN = 'N'
			AND a.LOG_SUBJECT_TYPE = 'KNOWLGMAP'
		</where>
		ORDER BY a.LOG_NO DESC
		LIMIT 30 OFFSET 0
	
	</select>

	<select id="selectModificationRequestList" parameterType="KnowledgeVO" resultType="KnowledgeVO">
		SELECT *
          FROM (SELECT TB_KNOWLEDGE_MODIFICATION_REQUEST.REQUEST_NO
		             , TB_KNOWLEDGE_MODIFICATION_REQUEST.KNOWLG_NO
		             , TB_KNOWLEDGE_MODIFICATION_REQUEST.REQUEST_CONTENT
		             , TB_KNOWLEDGE_MODIFICATION_REQUEST.ATCH_FILE_NO
		             , TB_KNOWLEDGE_MODIFICATION_REQUEST.REGISTER_ID
		             , TB_KNOWLEDGE_MODIFICATION_REQUEST.REGIST_DTM
                     , TB_USER.DISPLAY_NAME
                     , TB_USER.OU
                     , TB_KNOWLEDGE.TITLE
				     , TB_KNOWLEDGE.KNOWLG_MAP_TYPE
                     , TB_KNOWLEDGE_MAP.PARENT_KNOWLG_MAP_NM
					 , TB_KNOWLEDGE_MAP.KNOWLG_MAP_NM
					 , TB_KNOWLEDGE_MAP.PARENT_KNOWLG_MAP_NM AS UP_NM
					 , CASE WHEN DATEDIFF(TB_KNOWLEDGE_MODIFICATION_REQUEST.REGIST_DTM, SYSDATE()) > -4 THEN TRUE ELSE FALSE END AS IS_NEW
		          FROM TB_KNOWLEDGE_MODIFICATION_REQUEST
				  LEFT JOIN TB_USER ON TB_USER.SID = TB_KNOWLEDGE_MODIFICATION_REQUEST.REGISTER_ID
		          LEFT JOIN TB_KNOWLEDGE ON TB_KNOWLEDGE.KNOWLG_NO = TB_KNOWLEDGE_MODIFICATION_REQUEST.KNOWLG_NO
		          LEFT JOIN (SELECT TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO
		                          , TB_KNOWLEDGE_MAP.KNOWLG_MAP_NM
		                          , TB_KNOWLEDGE_MAP.DEL_YN
		                          , TB_KNOWLEDGE_MAP.SHOW_YN
		                          , PARENT.KNOWLG_MAP_NO AS PARENT_KNOWLG_MAP_NO
		                          , PARENT.KNOWLG_MAP_NM AS PARENT_KNOWLG_MAP_NM
		          			   FROM TB_KNOWLEDGE_MAP LEFT JOIN TB_KNOWLEDGE_MAP AS PARENT ON TB_KNOWLEDGE_MAP.UP_NO = PARENT.KNOWLG_MAP_NO) TB_KNOWLEDGE_MAP
		            ON TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO = TB_KNOWLEDGE.KNOWLG_MAP_NO
                 WHERE TB_KNOWLEDGE.DEL_YN = 'N'
				   AND TB_KNOWLEDGE.OWNER_ID = #{ownerId}
                   AND TB_KNOWLEDGE_MAP.DEL_YN = 'N'
                   AND TB_KNOWLEDGE_MAP.SHOW_YN = 'Y') TB_KNOWLEDGE_MODIFICATION_REQUEST
		<where>
			<if test="searchText != null and searchText != ''">
				AND TITLE LIKE '%' #{searchText} '%'
			</if>
		</where>
		 ORDER BY REGIST_DTM DESC
		 LIMIT #{itemCountPerPage} OFFSET #{itemOffset}
 	</select>

	<select id="selectModificationRequestListCount" parameterType="KnowledgeVO" resultType="int">
		SELECT count(REQUEST_NO)
          FROM (SELECT TB_KNOWLEDGE_MODIFICATION_REQUEST.REQUEST_NO
		             , TB_KNOWLEDGE_MODIFICATION_REQUEST.KNOWLG_NO
		             , TB_KNOWLEDGE_MODIFICATION_REQUEST.REQUEST_CONTENT
		             , TB_KNOWLEDGE_MODIFICATION_REQUEST.ATCH_FILE_NO
		             , TB_KNOWLEDGE_MODIFICATION_REQUEST.REGISTER_ID
		             , TB_KNOWLEDGE_MODIFICATION_REQUEST.REGIST_DTM
                     , TB_USER.DISPLAY_NAME
					 , TB_USER.OU
                     , TB_KNOWLEDGE.TITLE
					 , TB_KNOWLEDGE.KNOWLG_MAP_TYPE
			         , TB_KNOWLEDGE_MAP.PARENT_KNOWLG_MAP_NM
					 , TB_KNOWLEDGE_MAP.KNOWLG_MAP_NM
					 , TB_KNOWLEDGE_MAP.PARENT_KNOWLG_MAP_NM AS UP_NM
					 , CASE WHEN DATEDIFF(TB_KNOWLEDGE_MODIFICATION_REQUEST.REGIST_DTM, SYSDATE()) > -4 THEN TRUE ELSE FALSE END AS IS_NEW
		          FROM TB_KNOWLEDGE_MODIFICATION_REQUEST
				  LEFT JOIN TB_USER ON TB_USER.SID = TB_KNOWLEDGE_MODIFICATION_REQUEST.REGISTER_ID
		          LEFT JOIN TB_KNOWLEDGE ON TB_KNOWLEDGE.KNOWLG_NO = TB_KNOWLEDGE_MODIFICATION_REQUEST.KNOWLG_NO
		          LEFT JOIN (SELECT TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO
		                          , TB_KNOWLEDGE_MAP.KNOWLG_MAP_NM
		                          , TB_KNOWLEDGE_MAP.DEL_YN
		                          , TB_KNOWLEDGE_MAP.SHOW_YN
		                          , PARENT.KNOWLG_MAP_NO AS PARENT_KNOWLG_MAP_NO
		                          , PARENT.KNOWLG_MAP_NM AS PARENT_KNOWLG_MAP_NM
		          			   FROM TB_KNOWLEDGE_MAP LEFT JOIN TB_KNOWLEDGE_MAP AS PARENT ON TB_KNOWLEDGE_MAP.UP_NO = PARENT.KNOWLG_MAP_NO) TB_KNOWLEDGE_MAP
		            ON TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO = TB_KNOWLEDGE.KNOWLG_MAP_NO
                 WHERE TB_KNOWLEDGE.DEL_YN = 'N'
				   AND TB_KNOWLEDGE.OWNER_ID = #{ownerId}
                   AND TB_KNOWLEDGE_MAP.DEL_YN = 'N'
                   AND TB_KNOWLEDGE_MAP.SHOW_YN = 'Y') TB_KNOWLEDGE_MODIFICATION_REQUEST
		<where>
			<if test="searchText != null and searchText != ''">
				AND TITLE LIKE '%' #{searchText} '%'
			</if>
		</where>
    </select>

	<select id="selectModificationRequestDetail" parameterType="KnowledgeVO" resultType="KnowledgeVO">
		SELECT *
          FROM (SELECT TB_KNOWLEDGE_MODIFICATION_REQUEST.REQUEST_NO
		             , TB_KNOWLEDGE_MODIFICATION_REQUEST.KNOWLG_NO
		             , TB_KNOWLEDGE_MODIFICATION_REQUEST.REQUEST_CONTENT
		             , TB_KNOWLEDGE_MODIFICATION_REQUEST.ATCH_FILE_NO
		             , TB_KNOWLEDGE_MODIFICATION_REQUEST.REGISTER_ID
		             , TB_KNOWLEDGE_MODIFICATION_REQUEST.REGIST_DTM
                     , TB_USER.DISPLAY_NAME
                     , TB_USER.OU
                     , TB_KNOWLEDGE.TITLE
					 , TB_KNOWLEDGE.KNOWLG_MAP_TYPE
					 , TB_KNOWLEDGE_MAP.PARENT_KNOWLG_MAP_NM
					 , TB_KNOWLEDGE_MAP.KNOWLG_MAP_NM
					 , TB_KNOWLEDGE_MAP.PARENT_KNOWLG_MAP_NM AS UP_NM
					 , CASE WHEN DATEDIFF(TB_KNOWLEDGE_MODIFICATION_REQUEST.REGIST_DTM, SYSDATE()) > -4 THEN TRUE ELSE FALSE END AS IS_NEW
		          FROM TB_KNOWLEDGE_MODIFICATION_REQUEST
				  LEFT JOIN TB_USER ON TB_USER.SID = TB_KNOWLEDGE_MODIFICATION_REQUEST.REGISTER_ID
		          LEFT JOIN TB_KNOWLEDGE ON TB_KNOWLEDGE.KNOWLG_NO = TB_KNOWLEDGE_MODIFICATION_REQUEST.KNOWLG_NO
		          LEFT JOIN (SELECT TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO
		                          , TB_KNOWLEDGE_MAP.KNOWLG_MAP_NM
		                          , TB_KNOWLEDGE_MAP.DEL_YN
		                          , TB_KNOWLEDGE_MAP.SHOW_YN
		                          , PARENT.KNOWLG_MAP_NO AS PARENT_KNOWLG_MAP_NO
		                          , PARENT.KNOWLG_MAP_NM AS PARENT_KNOWLG_MAP_NM
		          			   FROM TB_KNOWLEDGE_MAP LEFT JOIN TB_KNOWLEDGE_MAP AS PARENT ON TB_KNOWLEDGE_MAP.UP_NO = PARENT.KNOWLG_MAP_NO) TB_KNOWLEDGE_MAP
		            ON TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO = TB_KNOWLEDGE.KNOWLG_MAP_NO
                 WHERE TB_KNOWLEDGE_MODIFICATION_REQUEST.REQUEST_NO = #{requestNo}
                   AND TB_KNOWLEDGE.DEL_YN = 'N'
				   AND TB_KNOWLEDGE.OWNER_ID = #{ownerId}
                   AND TB_KNOWLEDGE_MAP.DEL_YN = 'N'
                   AND TB_KNOWLEDGE_MAP.SHOW_YN = 'Y') TB_KNOWLEDGE_MODIFICATION_REQUEST
 	</select>

	<select id="selectModificationRequestContentList" parameterType="KnowledgeVO" resultType="KnowledgeContentsVO">
		SELECT REQUEST_CONTENT_NO
		     , REQUEST_NO
		     , SORT_ORDR
		     , SUBTITLE
		     , CONT
		  FROM TB_KNOWLEDGE_MODIFICATION_REQUEST_CONTENT
		 WHERE REQUEST_NO = #{requestNo}
 	</select>

	<select id="selectSucceedList" parameterType="KnowledgeVO" resultType="KnowledgeVO">
		SELECT *
          FROM (SELECT TB_KNOWLEDGE.KNOWLG_NO
		             , TB_KNOWLEDGE.TITLE
		             , TB_KNOWLEDGE.KNOWLG_MAP_NO
		             , TB_KNOWLEDGE.KNOWLG_MAP_TYPE
		             , TB_KNOWLEDGE.SUMMRY
		             , TB_KNOWLEDGE.APRV_YN
		             , TB_KNOWLEDGE.APRV_CONT
		             , TB_KNOWLEDGE.APPROVER_ID
		             , TB_KNOWLEDGE.RLS_YN
		             , TB_KNOWLEDGE.REAL_NM_YN
		             , TB_KNOWLEDGE.COPERTN_WRITNG_YN
		             , TB_KNOWLEDGE.OU_CODE
		             , TB_KNOWLEDGE.INQ_CNT
		             , TB_KNOWLEDGE.CMMNTY_NO
		             , TB_KNOWLEDGE.DOWNLOAD_CNT
		             , TB_KNOWLEDGE.REGISTER_ID
		             , TB_KNOWLEDGE.REGIST_DTM
		             , TB_KNOWLEDGE.UPDATER_ID
		             , TB_KNOWLEDGE.UPD_DTM
		             , TB_KNOWLEDGE.DEL_YN
		             , TB_KNOWLEDGE.ATCH_FILE_NO
		             , TB_KNOWLEDGE.RELATE_KNOWLG_NO
		             , TB_KNOWLEDGE.TARGET_NO
		             , TB_KNOWLEDGE.KEYWORD
		             , TB_KNOWLEDGE.OWNER_ID
		             , TB_USER.DISPLAY_NAME
		             , TB_USER.OU
                     , TB_KNOWLEDGE_MAP.PARENT_KNOWLG_MAP_NM
		             , CASE WHEN DATEDIFF(TB_KNOWLEDGE.REGIST_DTM, SYSDATE()) > -4 THEN TRUE ELSE FALSE END AS IS_NEW
		             , ROW_NUMBER() OVER(PARTITION BY TB_KNOWLEDGE.TITLE ORDER BY TB_KNOWLEDGE.KNOWLG_NO DESC) AS ROW_NUM
          			 , (SELECT OU FROM TB_ORG WHERE OU_CODE = TB_KNOWLEDGE.OU_CODE) AS OWNER_OU
				     , CASE WHEN TB_KNOWLEDGE.OU_CODE <![CDATA[<>]]> TB_USER.OU_CODE THEN 1 ELSE 0 END AS NEED_SUCCEED
		          FROM TB_KNOWLEDGE
		          LEFT JOIN TB_USER ON TB_USER.SID = TB_KNOWLEDGE.OWNER_ID
		          LEFT JOIN (SELECT TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO
		                          , TB_KNOWLEDGE_MAP.KNOWLG_MAP_NM
		                          , TB_KNOWLEDGE_MAP.DEL_YN
		                          , TB_KNOWLEDGE_MAP.SHOW_YN
		                          , PARENT.KNOWLG_MAP_NO AS PARENT_KNOWLG_MAP_NO
		                          , PARENT.KNOWLG_MAP_NM AS PARENT_KNOWLG_MAP_NM
		          			   FROM TB_KNOWLEDGE_MAP LEFT JOIN TB_KNOWLEDGE_MAP AS PARENT ON TB_KNOWLEDGE_MAP.UP_NO = PARENT.KNOWLG_MAP_NO) TB_KNOWLEDGE_MAP
		            ON TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO = TB_KNOWLEDGE.KNOWLG_MAP_NO
                 WHERE TB_KNOWLEDGE.DEL_YN = 'N'
                   AND TB_KNOWLEDGE_MAP.DEL_YN = 'N'
                   AND TB_KNOWLEDGE_MAP.SHOW_YN = 'Y') TB_KNOWLEDGE
		<include refid="selectListCondition" />
		   AND ROW_NUM = 1
		<if test="ownerId != null and ownerId != ''">
			AND OWNER_ID = #{ownerId}
		</if>
		   AND KNOWLG_MAP_TYPE <![CDATA[<>]]> 'PERSONAL'
		 ORDER BY NEED_SUCCEED DESC, KNOWLG_NO DESC
		 LIMIT #{itemCountPerPage} OFFSET #{itemOffset}
 	</select>

	<select id="selectSucceedListCount" parameterType="KnowledgeVO" resultType="int">
		SELECT COUNT(1)
          FROM (SELECT TB_KNOWLEDGE.KNOWLG_NO
		             , TB_KNOWLEDGE.TITLE
		             , TB_KNOWLEDGE.KNOWLG_MAP_NO
		             , TB_KNOWLEDGE.KNOWLG_MAP_TYPE
		             , TB_KNOWLEDGE.SUMMRY
		             , TB_KNOWLEDGE.APRV_YN
		             , TB_KNOWLEDGE.APRV_CONT
		             , TB_KNOWLEDGE.APPROVER_ID
		             , TB_KNOWLEDGE.RLS_YN
		             , TB_KNOWLEDGE.REAL_NM_YN
		             , TB_KNOWLEDGE.COPERTN_WRITNG_YN
		             , TB_KNOWLEDGE.OU_CODE
		             , TB_KNOWLEDGE.INQ_CNT
		             , TB_KNOWLEDGE.CMMNTY_NO
		             , TB_KNOWLEDGE.DOWNLOAD_CNT
		             , TB_KNOWLEDGE.REGISTER_ID
		             , TB_KNOWLEDGE.REGIST_DTM
		             , TB_KNOWLEDGE.UPDATER_ID
		             , TB_KNOWLEDGE.UPD_DTM
		             , TB_KNOWLEDGE.DEL_YN
		             , TB_KNOWLEDGE.ATCH_FILE_NO
		             , TB_KNOWLEDGE.RELATE_KNOWLG_NO
		             , TB_KNOWLEDGE.TARGET_NO
		             , TB_KNOWLEDGE.KEYWORD
					 , TB_KNOWLEDGE.OWNER_ID
		             , TB_USER.DISPLAY_NAME
		             , TB_USER.OU
                     , TB_KNOWLEDGE_MAP.PARENT_KNOWLG_MAP_NM
		             , CASE WHEN DATEDIFF(TB_KNOWLEDGE.REGIST_DTM, SYSDATE()) > -4 THEN TRUE ELSE FALSE END AS IS_NEW
		             , ROW_NUMBER() OVER(PARTITION BY TB_KNOWLEDGE.TITLE ORDER BY TB_KNOWLEDGE.KNOWLG_NO DESC) AS ROW_NUM
					 , (SELECT OU FROM TB_ORG WHERE OU_CODE = TB_KNOWLEDGE.OU_CODE) AS OWNER_OU
					 , CASE WHEN TB_KNOWLEDGE.OU_CODE <![CDATA[<>]]> TB_USER.OU_CODE THEN 1 ELSE 0 END AS NEED_SUCCEED
		          FROM TB_KNOWLEDGE
				  LEFT JOIN TB_USER ON TB_USER.SID = TB_KNOWLEDGE.OWNER_ID
		          LEFT JOIN (SELECT TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO
		                          , TB_KNOWLEDGE_MAP.KNOWLG_MAP_NM
		                          , TB_KNOWLEDGE_MAP.DEL_YN
		                          , TB_KNOWLEDGE_MAP.SHOW_YN
		                          , PARENT.KNOWLG_MAP_NO AS PARENT_KNOWLG_MAP_NO
		                          , PARENT.KNOWLG_MAP_NM AS PARENT_KNOWLG_MAP_NM
		          			   FROM TB_KNOWLEDGE_MAP LEFT JOIN TB_KNOWLEDGE_MAP AS PARENT ON TB_KNOWLEDGE_MAP.UP_NO = PARENT.KNOWLG_MAP_NO) TB_KNOWLEDGE_MAP
		            ON TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO = TB_KNOWLEDGE.KNOWLG_MAP_NO
                 WHERE TB_KNOWLEDGE.DEL_YN = 'N'
                   AND TB_KNOWLEDGE_MAP.DEL_YN = 'N'
                   AND TB_KNOWLEDGE_MAP.SHOW_YN = 'Y') TB_KNOWLEDGE
		<include refid="selectListCondition" />
		   AND ROW_NUM = 1
		<if test="ownerId != null and ownerId != ''">
			AND OWNER_ID = #{ownerId}
		</if>
		   AND KNOWLG_MAP_TYPE <![CDATA[<>]]> 'PERSONAL'
    </select>

	<update id="updateOwner" parameterType="KnowledgeVO">
		UPDATE TB_KNOWLEDGE
		   SET OWNER_ID = #{ownerId}
		 WHERE DEL_YN = 'N'
		   AND TITLE IN
		<foreach collection="titleList" item="title" open="(" close=")" separator=",">
			#{title}
		</foreach>
	</update>

	<select id="selectApprovalList" parameterType="KnowledgeVO" resultType="KnowledgeVO">
		WITH RECURSIVE TB_ORG_CTE AS (
			SELECT OU
				 , OU_CODE
				 , PARENT_OU_CODE
				 , 1 AS LEVEL
			  FROM TB_ORG
			 WHERE OU_CODE = #{ouCode}
			 UNION ALL
			SELECT TB_ORG.OU
				 , TB_ORG.OU_CODE
				 , TB_ORG.PARENT_OU_CODE
				 , 1 + LEVEL AS LEVEL
			  FROM TB_ORG
			 INNER JOIN TB_ORG_CTE ON TB_ORG_CTE.OU_CODE = TB_ORG.PARENT_OU_CODE
		)
		SELECT *
          FROM (SELECT TB_KNOWLEDGE.KNOWLG_NO
		             , TB_KNOWLEDGE.TITLE
		             , TB_KNOWLEDGE.KNOWLG_MAP_NO
		             , TB_KNOWLEDGE.KNOWLG_MAP_TYPE
		             , TB_KNOWLEDGE.SUMMRY
		             , TB_KNOWLEDGE.APRV_YN
		             , TB_KNOWLEDGE.APRV_CONT
		             , TB_KNOWLEDGE.APPROVER_ID
		             , TB_KNOWLEDGE.RLS_YN
		             , TB_KNOWLEDGE.REAL_NM_YN
		             , TB_KNOWLEDGE.COPERTN_WRITNG_YN
		             , TB_KNOWLEDGE.OU_CODE
		             , TB_KNOWLEDGE.INQ_CNT
		             , TB_KNOWLEDGE.CMMNTY_NO
		             , TB_KNOWLEDGE.DOWNLOAD_CNT
		             , TB_KNOWLEDGE.REGISTER_ID
		             , TB_KNOWLEDGE.REGIST_DTM
					 , DATE_FORMAT(TB_KNOWLEDGE.REGIST_DTM, '%Y-%m-%d %T') AS REGIST_DTM_STR
		             , TB_KNOWLEDGE.UPDATER_ID
		             , TB_KNOWLEDGE.UPD_DTM
		             , TB_KNOWLEDGE.DEL_YN
		             , TB_KNOWLEDGE.ATCH_FILE_NO
		             , TB_KNOWLEDGE.RELATE_KNOWLG_NO
		             , TB_KNOWLEDGE.TARGET_NO
		             , TB_KNOWLEDGE.KEYWORD
		             , TB_KNOWLEDGE.OWNER_ID
		             , TB_USER.DISPLAY_NAME
		             , TB_USER.OU
                     , TB_KNOWLEDGE_MAP.PARENT_KNOWLG_MAP_NM
		             , CASE WHEN DATEDIFF(TB_KNOWLEDGE.REGIST_DTM, SYSDATE()) > -4 THEN TRUE ELSE FALSE END AS IS_NEW
          			 , (SELECT OU FROM TB_ORG WHERE OU_CODE = TB_KNOWLEDGE.OU_CODE) AS OWNER_OU
		          FROM TB_KNOWLEDGE
		          LEFT JOIN TB_USER ON TB_USER.SID = TB_KNOWLEDGE.REGISTER_ID
		          LEFT JOIN (SELECT TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO
		                          , TB_KNOWLEDGE_MAP.KNOWLG_MAP_NM
		                          , TB_KNOWLEDGE_MAP.DEL_YN
		                          , TB_KNOWLEDGE_MAP.SHOW_YN
		                          , PARENT.KNOWLG_MAP_NO AS PARENT_KNOWLG_MAP_NO
		                          , PARENT.KNOWLG_MAP_NM AS PARENT_KNOWLG_MAP_NM
		          			   FROM TB_KNOWLEDGE_MAP LEFT JOIN TB_KNOWLEDGE_MAP AS PARENT ON TB_KNOWLEDGE_MAP.UP_NO = PARENT.KNOWLG_MAP_NO) TB_KNOWLEDGE_MAP
		            ON TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO = TB_KNOWLEDGE.KNOWLG_MAP_NO
                 WHERE TB_KNOWLEDGE.DEL_YN = 'N'
                   AND TB_KNOWLEDGE_MAP.DEL_YN = 'N'
                   AND TB_KNOWLEDGE_MAP.SHOW_YN = 'Y') TB_KNOWLEDGE
		<include refid="selectListCondition" />
		   AND KNOWLG_MAP_TYPE <![CDATA[<>]]> 'PERSONAL'
		   AND TB_KNOWLEDGE.OU_CODE IN (SELECT TB_ORG_CTE.OU_CODE FROM TB_ORG_CTE)
		 ORDER BY KNOWLG_NO DESC
		 LIMIT #{itemCountPerPage} OFFSET #{itemOffset}
 	</select>

	<select id="selectApprovalListCount" parameterType="KnowledgeVO" resultType="int">
		WITH RECURSIVE TB_ORG_CTE AS (
			SELECT OU
				 , OU_CODE
				 , PARENT_OU_CODE
				 , 1 AS LEVEL
			  FROM TB_ORG
			 WHERE OU_CODE = #{ouCode}
			 UNION ALL
			SELECT TB_ORG.OU
				 , TB_ORG.OU_CODE
				 , TB_ORG.PARENT_OU_CODE
				 , 1 + LEVEL AS LEVEL
			  FROM TB_ORG
			 INNER JOIN TB_ORG_CTE ON TB_ORG_CTE.OU_CODE = TB_ORG.PARENT_OU_CODE
		)
		SELECT COUNT(1)
          FROM (SELECT TB_KNOWLEDGE.KNOWLG_NO
		             , TB_KNOWLEDGE.TITLE
		             , TB_KNOWLEDGE.KNOWLG_MAP_NO
		             , TB_KNOWLEDGE.KNOWLG_MAP_TYPE
		             , TB_KNOWLEDGE.SUMMRY
		             , TB_KNOWLEDGE.APRV_YN
		             , TB_KNOWLEDGE.APRV_CONT
		             , TB_KNOWLEDGE.APPROVER_ID
		             , TB_KNOWLEDGE.RLS_YN
		             , TB_KNOWLEDGE.REAL_NM_YN
		             , TB_KNOWLEDGE.COPERTN_WRITNG_YN
		             , TB_KNOWLEDGE.OU_CODE
		             , TB_KNOWLEDGE.INQ_CNT
		             , TB_KNOWLEDGE.CMMNTY_NO
		             , TB_KNOWLEDGE.DOWNLOAD_CNT
		             , TB_KNOWLEDGE.REGISTER_ID
		             , TB_KNOWLEDGE.REGIST_DTM
					 , DATE_FORMAT(TB_KNOWLEDGE.REGIST_DTM, '%Y-%m-%d %T') AS REGIST_DTM_STR
		             , TB_KNOWLEDGE.UPDATER_ID
		             , TB_KNOWLEDGE.UPD_DTM
		             , TB_KNOWLEDGE.DEL_YN
		             , TB_KNOWLEDGE.ATCH_FILE_NO
		             , TB_KNOWLEDGE.RELATE_KNOWLG_NO
		             , TB_KNOWLEDGE.TARGET_NO
		             , TB_KNOWLEDGE.KEYWORD
					 , TB_KNOWLEDGE.OWNER_ID
		             , TB_USER.DISPLAY_NAME
		             , TB_USER.OU
                     , TB_KNOWLEDGE_MAP.PARENT_KNOWLG_MAP_NM
		             , CASE WHEN DATEDIFF(TB_KNOWLEDGE.REGIST_DTM, SYSDATE()) > -4 THEN TRUE ELSE FALSE END AS IS_NEW
					 , (SELECT OU FROM TB_ORG WHERE OU_CODE = TB_KNOWLEDGE.OU_CODE) AS OWNER_OU
		          FROM TB_KNOWLEDGE
		          LEFT JOIN TB_USER ON TB_USER.SID = TB_KNOWLEDGE.REGISTER_ID
		          LEFT JOIN (SELECT TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO
		                          , TB_KNOWLEDGE_MAP.KNOWLG_MAP_NM
		                          , TB_KNOWLEDGE_MAP.DEL_YN
		                          , TB_KNOWLEDGE_MAP.SHOW_YN
		                          , PARENT.KNOWLG_MAP_NO AS PARENT_KNOWLG_MAP_NO
		                          , PARENT.KNOWLG_MAP_NM AS PARENT_KNOWLG_MAP_NM
		          			   FROM TB_KNOWLEDGE_MAP LEFT JOIN TB_KNOWLEDGE_MAP AS PARENT ON TB_KNOWLEDGE_MAP.UP_NO = PARENT.KNOWLG_MAP_NO) TB_KNOWLEDGE_MAP
		            ON TB_KNOWLEDGE_MAP.KNOWLG_MAP_NO = TB_KNOWLEDGE.KNOWLG_MAP_NO
                 WHERE TB_KNOWLEDGE.DEL_YN = 'N'
                   AND TB_KNOWLEDGE_MAP.DEL_YN = 'N'
                   AND TB_KNOWLEDGE_MAP.SHOW_YN = 'Y') TB_KNOWLEDGE
		<include refid="selectListCondition" />
		   AND KNOWLG_MAP_TYPE <![CDATA[<>]]> 'PERSONAL'
		   AND TB_KNOWLEDGE.OU_CODE IN (SELECT TB_ORG_CTE.OU_CODE FROM TB_ORG_CTE)
    </select>

	<select id="checkDuplication" parameterType="KnowledgeVO" resultType="int">
		SELECT count(TB_KNOWLEDGE.KNOWLG_NO)
		  FROM TB_KNOWLEDGE
		 WHERE TITLE = #{title}
		   AND DEL_YN = 'N'
	</select>

	<!-- 지식 조회 여부 확인 -->
	<select id="countKnowledgeView" parameterType="KnowledgeVO" resultType="int">
		SELECT COUNT(1)
		  FROM TB_KNOWLEDGE_VIEW
		 WHERE TITLE = #{title}
		   AND REGISTER_ID = #{registerId}
		   AND DATE_FORMAT(REGIST_DTM, '%Y-%m-%d') = DATE_FORMAT(now(), '%Y-%m-%d')
	</select>

	<!-- 지식 조회 여부 등록 -->
	<insert id="insertKnowledgeView" parameterType="KnowledgeVO">
		INSERT INTO TB_KNOWLEDGE_VIEW
		     ( KNOWLG_NO
		     , TITLE
		     , REGISTER_ID
		     , REGIST_DTM
		     )
		VALUES
			 ( #{knowlgNo}
			 , #{title}
			 , #{registerId}
			 , now()
			)
	</insert>
</mapper>